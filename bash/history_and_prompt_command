# Infinite history {{{  ---------------------------------------------------
## History
# See also https://unix.stackexchange.com/a/48113
#
shopt -s histappend                 # append to history, don't overwrite it
export HISTSIZE=5000000000000              # 50,000 lines of history, pbly about 1.5 MB.  Why not??!!
export HISTFILESIZE=500000000000000        # 500,000 lines of history, pbly about 10.5 MB.  Why not??!!
# HISTCONTROL=ignoreboth            # ignores lines with repeated entries, but then you can't do this:
#       cut -f1 -d" " .bash_history | sort | uniq -c | sort -nr | head -n 30
#       In other words, just what do you spend so much time typing? Here's the money:
#       Anything in at least the top ten, assuming it is not from some massive one-time splurge,
#       needs to be aliased to a one or two letter shorthand.
# }}}
# Bash History Syncing {{{  ---------------------------------------------------
# After every command: append to file, clear memory, reload from file.
# This gives cross-shell history visibility (up-arrow shows commands from
# other open shells).
#
# IMPORTANT: We APPEND to PROMPT_COMMAND rather than overwriting it.
# Ghostty shell integration (prompt marking, Cmd+Triple-Click) and other
# tools hook into PROMPT_COMMAND before rc files load. A hard assignment
# like PROMPT_COMMAND="..." would destroy those hooks.
#
# History: Previously used _jason_safe_bash_history_sync with flock to
# guard against truncation. Replaced by daily backup rotation
# (bin/bash-history-backup) which is simpler and more reliable.
PROMPT_COMMAND="${PROMPT_COMMAND:+$PROMPT_COMMAND;} history -a; history -c; history -r"
# }}}
# Bash History Backup {{{  ---------------------------------------------------
# Daily rotation backup of ~/.bash_history into ~/.bash_history.d/
# Runs once per day on first shell login. If history ever gets truncated,
# restore from the most recent backup:
#   cp ~/.bash_history.d/bash_history.YYYY-MM-DD ~/.bash_history
if [[ -x "$HOME/.dotfiles/bin/bash-history-backup" ]]; then
  ("$HOME/.dotfiles/bin/bash-history-backup" &) 2>/dev/null
fi
# }}}

# " vim:set expandtab tabstop=4 softtabstop=4 shiftwidth=4 foldenable foldmethod=marker foldlevel=0:
